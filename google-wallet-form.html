<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Wallet - Vytvo≈ôen√≠ ≈°ablony vƒõrnostn√≠ karty</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background: #f5f5f5;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      line-height: 1.6;
    }
    
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: white;
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }
    
    .header {
      background: linear-gradient(135deg, #4285f4, #34a853);
      color: white;
      padding: 30px;
      text-align: center;
    }
    
    .header h1 {
      font-size: 28px;
      margin-bottom: 10px;
    }
    
    .header p {
      opacity: 0.9;
      font-size: 16px;
    }
    
    .form-container {
      padding: 40px;
    }
    
    .form-group {
      margin-bottom: 25px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #333;
      font-size: 14px;
    }
    
    .form-group input,
    .form-group textarea,
    .form-group select {
      width: 100%;
      padding: 12px 16px;
      border: 2px solid #e1e5e9;
      border-radius: 8px;
      font-size: 16px;
      transition: border-color 0.3s ease;
      font-family: inherit;
    }
    
    .form-group input:focus,
    .form-group textarea:focus,
    .form-group select:focus {
      outline: none;
      border-color: #4285f4;
      box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.1);
    }
    
    .form-group textarea {
      resize: vertical;
      min-height: 100px;
    }
    
    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }
    
    .color-input {
      height: 50px !important;
      cursor: pointer;
    }
    
    .submit-btn {
      background: linear-gradient(135deg, #4285f4, #34a853);
      color: white;
      padding: 16px 32px;
      border: none;
      border-radius: 8px;
      font-size: 18px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      width: 100%;
      margin-top: 20px;
    }
    
    .submit-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(66, 133, 244, 0.3);
    }
    
    .submit-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }
    
    .status-message {
      margin-top: 20px;
      padding: 15px;
      border-radius: 8px;
      font-weight: 500;
      text-align: center;
      display: none;
    }
    
    .status-success {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }
    
    .status-error {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }
    
    .status-loading {
      background: #d1ecf1;
      color: #0c5460;
      border: 1px solid #bee5eb;
    }
    
    .help-text {
      font-size: 12px;
      color: #666;
      margin-top: 5px;
      font-style: italic;
    }
    
    @media (max-width: 768px) {
      .form-row {
        grid-template-columns: 1fr;
      }
      
      .container {
        margin: 10px;
      }
      
      .form-container {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>üéØ Google Wallet</h1>
      <p>Vytvo≈ôen√≠ ≈°ablony vƒõrnostn√≠ karty</p>
    </div>
    
    <div class="form-container">
      <form id="googleWalletForm">
        <div class="form-group">
          <label for="classId">ID ≈°ablony (Class ID) *</label>
          <input type="text" id="classId" name="classId" required 
                 placeholder="nap≈ô. loyalty_class_001">
          <div class="help-text">Unik√°tn√≠ identifik√°tor ≈°ablony (pouze p√≠smena, ƒç√≠sla a podtr≈æ√≠tka)</div>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="issuerName">N√°zev vydavatele *</label>
            <input type="text" id="issuerName" name="issuerName" required 
                   placeholder="N√°zev va≈°√≠ firmy">
          </div>
          
          <div class="form-group">
            <label for="programName">N√°zev programu *</label>
            <input type="text" id="programName" name="programName" required 
                   placeholder="Vƒõrnostn√≠ program">
          </div>
        </div>
        
        <div class="form-group">
          <label for="programDescription">Popis programu</label>
          <textarea id="programDescription" name="programDescription" 
                    placeholder="Kr√°tk√Ω popis va≈°eho vƒõrnostn√≠ho programu..."></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="programLogo">URL loga programu</label>
            <input type="url" id="programLogo" name="programLogo" 
                   placeholder="https://example.com/logo.png">
            <div class="help-text">Doporuƒçen√° velikost: 640x246px</div>
          </div>
          
          <div class="form-group">
            <label for="hexBackgroundColor">Barva pozad√≠</label>
            <input type="color" id="hexBackgroundColor" name="hexBackgroundColor" 
                   value="#4285f4" class="color-input">
          </div>
        </div>

        <div class="form-group">
          <label for="heroImageUrl">URL stripu (Hero image)</label>
          <input type="url" id="heroImageUrl" name="heroImageUrl" 
                 placeholder="https://example.com/hero.png">
          <div class="help-text">Doporuƒçen√° velikost: 1032√ó336 px (pomƒõr 3:1). Zobraz√≠ se jako strip pod horn√≠ hlaviƒçkou.</div>
        </div>

        <!-- Textov√© moduly (3 sloty) -->
        <div class="form-group">
          <label>Textov√© moduly (3 sloty ‚Äì nadpis a hodnota)</label>
          <div class="help-text">Tyto polo≈æky se ulo≈æ√≠ do ≈°ablony (class) a zobraz√≠ se tak√© jako 3 ≈ô√°dky (label/value). Konkr√©tn√≠ karta (object) je m≈Ø≈æe p≈ôeb√≠t vlastn√≠mi hodnotami.</div>
          <div class="form-row" style="margin-top: 10px;">
            <div>
              <input type="text" name="tm1_header" placeholder="Pole 1">
            </div>
            <div>
              <input type="text" name="tm1_body" placeholder="Hodnota 1">
            </div>
          </div>
          <div class="form-row" style="margin-top: 10px;">
            <div>
              <input type="text" name="tm2_header" placeholder="Pole 2">
            </div>
            <div>
              <input type="text" name="tm2_body" placeholder="Hodnota 2">
            </div>
          </div>
          <div class="form-row" style="margin-top: 10px;">
            <div>
              <input type="text" name="tm3_header" placeholder="Pole 3">
            </div>
            <div>
              <input type="text" name="tm3_body" placeholder="Hodnota 3">
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label for="localizedIssuerName">Lokalizovan√Ω n√°zev vydavatele (CS)</label>
            <input type="text" id="localizedIssuerName" name="localizedIssuerName" 
                   placeholder="ƒåesk√Ω n√°zev firmy">
          </div>
          
          <div class="form-group">
            <label for="localizedProgramName">Lokalizovan√Ω n√°zev programu (CS)</label>
            <input type="text" id="localizedProgramName" name="localizedProgramName" 
                   placeholder="ƒåesk√Ω n√°zev programu">
          </div>
        </div>
        
        <div class="form-group">
          <label for="rewardsTier">√örove≈à odmƒõn</label>
          <select id="rewardsTier" name="rewardsTier">
            <option value="">Vyberte √∫rove≈à...</option>
            <option value="BRONZE">Bronzov√°</option>
            <option value="SILVER">St≈ô√≠brn√°</option>
            <option value="GOLD">Zlat√°</option>
            <option value="PLATINUM">Platinov√°</option>
          </select>
        </div>
        
        <div class="form-group">
          <label for="businessId">ID podniku (voliteln√©)</label>
          <input type="text" id="businessId" name="businessId" 
                 placeholder="nap≈ô. cafe_001">
          <div class="help-text">Pro propojen√≠ s existuj√≠c√≠m podnikem v syst√©mu</div>
        </div>
        
        <button type="submit" class="submit-btn" id="submitBtn">
          Vytvo≈ôit Google Wallet ≈°ablonu
        </button>
        
        <div id="statusMessage" class="status-message"></div>
      </form>
    </div>
  </div>

  <script>
    const form = document.getElementById('googleWalletForm');
    const submitBtn = document.getElementById('submitBtn');
    const statusMessage = document.getElementById('statusMessage');
    
    // Firebase Cloud Function URL - zmƒõ≈à na spr√°vnou URL po nasazen√≠
    const CLOUD_FUNCTION_URL = 'https://creategooglewallettemplate-weeqy2w2la-uc.a.run.app';
    
    function showStatus(message, type) {
      statusMessage.textContent = message;
      statusMessage.className = `status-message status-${type}`;
      statusMessage.style.display = 'block';
      
      if (type === 'success' || type === 'error') {
        setTimeout(() => {
          statusMessage.style.display = 'none';
        }, 5000);
      }
    }
    
    function validateClassId(classId) {
      const regex = /^[a-zA-Z0-9_]+$/;
      return regex.test(classId);
    }
    
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = new FormData(form);
      const data = Object.fromEntries(formData.entries());
      
      // Validace Class ID
      if (!validateClassId(data.classId)) {
        showStatus('Class ID m≈Ø≈æe obsahovat pouze p√≠smena, ƒç√≠sla a podtr≈æ√≠tka!', 'error');
        return;
      }
      
      // P≈ô√≠prava dat podle updateUserData patternu
      const templateData = {
        classId: data.classId,
        issuerName: data.issuerName,
        programName: data.programName,
        programDescription: data.programDescription || null,
        programLogo: data.programLogo || null,
        hexBackgroundColor: data.hexBackgroundColor || '#4285f4',
        // Hero image pro zobrazen√≠ stripu (poskytneme jak jednoduch√© URL, tak objekt heroImage)
        heroImageUrl: data.heroImageUrl || null,
        heroImage: data.heroImageUrl ? { sourceUri: { uri: data.heroImageUrl } } : null,
        localizedIssuerName: data.localizedIssuerName || data.issuerName,
        localizedProgramName: data.localizedProgramName || data.programName,
        rewardsTier: data.rewardsTier || null,
        businessId: data.businessId || null,
        timestamp: new Date().toISOString(),
        issuerId: '3388000000022981331',
        fullClassId: `3388000000022981331.${data.classId}`,
        status: 'created'
      };

      // Sestavit class-level textModulesData (a≈æ 3 polo≈æky) s pevn√Ωmi ID: pole1‚Äìpole3
      const tms = [];
      const addTM = (id, h, b) => {
        const header = (h || '').trim();
        const body = (b || '').trim();
        if (header || body) tms.push({ id, header, body });
      };
      // Defaultn√≠ nadpisy pro 3 sloty: Pole 1/2/3
      const tm1h = (data.tm1_header || 'Pole 1');
      const tm2h = (data.tm2_header || 'Pole 2');
      const tm3h = (data.tm3_header || 'Pole 3');
      addTM('pole1', tm1h, data.tm1_body);
      addTM('pole2', tm2h, data.tm2_body);
      addTM('pole3', tm3h, data.tm3_body);
      if (tms.length) {
        templateData.textModulesData = tms;
      }
      
      // Payload podle updateUserData patternu: { id, data }
      const payload = {
        id: data.classId,
        data: templateData
      };
      
      // UI feedback
      submitBtn.disabled = true;
      submitBtn.textContent = 'Vytv√°≈ôen√≠ ≈°ablony...';
      showStatus('Odes√≠l√°n√≠ dat na server...', 'loading');
      
      try {
        const response = await fetch(CLOUD_FUNCTION_URL, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: JSON.stringify(payload)
        });
        
        const result = await response.json();
        
        if (response.ok) {
          showStatus(`‚úÖ ≈†ablona √∫spƒõ≈°nƒõ vytvo≈ôena! Class ID: ${result.classId}`, 'success');
          form.reset();
          document.getElementById('hexBackgroundColor').value = '#4285f4';
        } else {
          throw new Error(result.error || 'Nezn√°m√° chyba serveru');
        }
        
      } catch (error) {
        console.error('Error:', error);
        showStatus(`‚ùå Chyba: ${error.message}`, 'error');
      } finally {
        submitBtn.disabled = false;
        submitBtn.textContent = 'Vytvo≈ôit Google Wallet ≈°ablonu';
      }
    });
    
    // Real-time validace Class ID
    document.getElementById('classId').addEventListener('input', (e) => {
      const value = e.target.value;
      if (value && !validateClassId(value)) {
        e.target.style.borderColor = '#dc3545';
      } else {
        e.target.style.borderColor = '#e1e5e9';
      }
    });
  </script>
</body>
</html>
